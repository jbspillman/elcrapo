<!DOCTYPE html>
<html>
<head>
    <title>CanvasJS Tabbed Charts</title>
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
    <style>
        .tab {
            display: inline-block;
            padding: 10px 20px;
            margin-right: 5px;
            background-color: #eee;
            cursor: pointer;
        }
        .tab.active {
            background-color: #ccc;
            font-weight: bold;
        }
        .chart-container {
            display: none;
            height: 400px;
            width: 100%;
        }
        .chart-container.active {
            display: block;
        }
    </style>
</head>
<body>

<div>
    <div class="tab active" onclick="showChart('iops')">IOPS</div>
    <div class="tab" onclick="showChart('mibs')">MiBs</div>
    <div class="tab" onclick="showChart('lat')">Latency</div>
</div>

<div id="chart-iops" class="chart-container active"></div>
<div id="chart-mibs" class="chart-container"></div>
<div id="chart-lat" class="chart-container"></div>

<script>
    const groupedData = {
        "1": {
            "WCX11.2.19": { "iops": 1204.0, "mibs": 1204.0, "lat": 829.0 },
            "WCX10.1.33": { "iops": 1255.0, "mibs": 1255.0, "lat": 795.0 }
        },
        "2": {
            "WCX11.2.19": { "iops": 1175.0, "mibs": 1175.0, "lat": 1693.0 },
            "WCX10.1.33": { "iops": 2561.0, "mibs": 2561.0, "lat": 777.0 }
        },
        "4": {
            "WCX11.2.19": { "iops": 808.0, "mibs": 808.0, "lat": 4927.0 },
            "WCX10.1.33": { "iops": 5134.0, "mibs": 5134.0, "lat": 775.0 }
        }
    };

    const targets = [...new Set(Object.values(groupedData).flatMap(d => Object.keys(d)))];

    function createChart(metric, containerId, yTitle) {
        const dataSeries = targets.map(target => ({
            type: "column",
            name: target,
            showInLegend: true,
            dataPoints: Object.entries(groupedData).map(([threads, targetsData]) => ({
                label: `${threads} Threads`,
                y: targetsData[target]?.[metric] || 0
            }))
        }));

        return new CanvasJS.Chart(containerId, {
            animationEnabled: true,
            title: { text: `${metric.toUpperCase()} by Threads and Target` },
            axisY: { title: yTitle },
            axisX: { title: "Threads" },
            legend: { cursor: "pointer" },
            toolTip: { shared: true },
            data: dataSeries
        });
    }

    const charts = {
        iops: createChart("iops", "chart-iops", "IOPS"),
        mibs: createChart("mibs", "chart-mibs", "MiBs/sec"),
        lat: createChart("lat", "chart-lat", "Latency (Âµs)")
    };

    Object.values(charts).forEach(chart => chart.render());

    function showChart(type) {
        document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
        document.querySelectorAll(".chart-container").forEach(div => div.classList.remove("active"));

        document.querySelector(`.tab[onclick="showChart('${type}')"]`).classList.add("active");
        document.getElementById(`chart-${type}`).classList.add("active");

        charts[type].render(); // Optional in case of redraw
    }
</script>

</body>
</html>
